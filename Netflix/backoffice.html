<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <title>BenchOffice</title>
  </head>
  <body>
    
    <div class="container">
        <div class="page mt-3 mb-3">
            <h3>BackOffice CRUD Operations:</h3>
        </div>
        <div class="col-8">
        <div class="form mt-4">
            <form onsubmit = collectDetails(event) >
                <div class="form-group">
            
                <div class="form-group">
                  <label for="formGroupExampleInput2">Name</label>
                  <input type="text" class="form-control name" id="formGroupExampleInput2" placeholder="name" required>
                </div>
                <div class="form-group">
                    <label for="formGroupExampleInput">Category</label>
                    <input type="text" class="form-control category" id="formGroupExampleInput" placeholder="category" required>
                  </div>
                  <div class="form-group">
                    <label for="formGroupExampleInput">imageUrl</label>
                    <input type="text" class="form-control imageUrl" id="formGroupExampleInput" placeholder="image URL" required>
                  </div>
                  <div class="form-group">
                    <label for="formGroupExampleInput">Description</label>
                    <input type="text" class="form-control description" id="formGroupExampleInput" placeholder="Describe" required>
                  </div>
                  <div class="buttons d-flex justify-content-between">
                  <button type="submit" class="btn btn-success btn-lg">Submit</button>
                  
                  <button type="button" class="btn btn-danger btn-lg">Delete</button>
                </div>
              </form>
            </div>
        </div>
    </div>
    <!-- <div class="container">
        <div class="row">
            <div class="col">
                <img src="media/media0.webp" alt="">
                <img src="media/media1.jpg" alt="">
                <img src="media/media2.webp" alt="">
                <img src="media/media3.webp" alt="">
                <img src="media/media4.jpg" alt="">
                <img src="media/media5.webp" alt="">

            </div>
        </div>
    </div> -->
</body>

<script>
let obj ={}
const url = "https://striveschool-api.herokuapp.com/api/movies/"
const headers = new Headers({
"Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MGRjNWU1M2IzNTgxNzAwMTVjMjI2ZmEiLCJpYXQiOjE2Mjk0NDU5OTAsImV4cCI6MTYzMDY1NTU5MH0.VcFZIcYIpoxcopas7_ZACwRYcUViSfPe8AHDmMYBxvE",
"content-type" : "Application/json"
})

/////Editing Work ///
 
const cat = new URLSearchParams(window.location.search).get("cat")
const id = new URLSearchParams(window.location.search).get("id")
console.log(id)
console.log(cat)
let endpoint = cat? url+cat : url
let newendp = id? url+id : url
console.log(endpoint)
let method = id ? 'PUT' : 'POST'
 

const getproductonpage = async() => {
  const response = await  fetch(endpoint,{
      headers
    })
    let data = await response.json()
    console.log('hello',data)
    prefilldata = data.filter((ele)  => ele._id===id)
    console.log('hey',prefilldata)
    prefilldata.map(ele => {
      document.querySelector('.name').value =ele.name
    document.querySelector('.category').value =ele.category
    document.querySelector('.imageUrl').value = ele.imageUrl
    document.querySelector('.description').value = ele.description
    })
    
}

if(id){
  getproductonpage()
}

    

  

    const collectDetails =  async(event)  =>
  {
    
    event.preventDefault()

        obj["name"] = `${document.querySelector('.name').value}`
        obj["category"] = `${document.querySelector('.category').value}`
        obj["imageUrl"] = `${document.querySelector('.imageUrl').value}`
        obj["description"] = `${document.querySelector('.description').value}`
  
        console.log(obj)
    
  try {
        const response = await fetch(newendp, {
            headers,
        method,
        body: JSON.stringify(obj),
         
            })
        if(response.ok){
            alert("POsted/Edited Successfully")
        }
        else{
            throw  new error('something went wrong')
        }
  } 
  catch (error) {
        console.log(error.msg)
  }
  
 
//   const response = await fetch("https://striveschool-api.herokuapp.com/api/movies/", {
//   method:'POST',
//   body: JSON.stringify(obj),
//     headers
// }) 



}

</script>

</html>